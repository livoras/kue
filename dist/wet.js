!function t(e,n,r){function o(i,c){if(!n[i]){if(!e[i]){var s="function"==typeof require&&require;if(!c&&s)return s(i,!0);if(a)return a(i,!0);throw new Error("Cannot find module '"+i+"'")}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return o(n?n:t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(t,e,n){function r(t,e,n){this.arr=t,this.scope=n,this.path=e}var o=t("./object-path"),a=t("./util"),i=r.prototype;a.each(["replace","pop","push","shift","unshift","splice","sort","reverse"],function(t){i[t]=function(){var e=this.arr[t].apply(this.arr,arguments);return this.scope.$root.broadcast(o.makeArrayEvent(t,this.path),arguments),e}}),e.exports=r},{"./object-path":17,"./util":21}],2:[function(t,e,n){function r(t,e,n){s.each(t,function(t){s.each(t.paths,function(t){e.scope.watch(t,n)})})}function o(t){if(s.isString(t))return u.parseTokensAndPaths(t);var e="";for(key in t)e+=t[key];return u.parseTokensAndPaths(e)}function a(t){var e=new RegExp("^"+c.directivePrefix+"-([\\w\\d]+)"),n=t.name.match(e);return n?n[1]:void 0}function i(t){for(var e=["component","repeat","on"],n=0,r=e.length;r>n;n++)if(e[n]===t)return!0;return!1}var c=t("./config"),s=t("./util"),u=t("./parser"),h=t("./directives");n.bindText=function(t,e){function n(){var n=o;s.each(a,function(t){var r=u.exec(t,e.scope);n=n.replace(t.rawExp,r)}),t.nodeValue?t.nodeValue=n:t.textNode=n}var o=t.textContent||t.nodeValue,a=u.parse(o);n(),r(a,e,n)},n.bindDir=function(t,e,n){var r=a(t);if(r){if(!h[r])throw new Error("directive `"+r+"` is not found.");var c=u.parseDirective(t.value),p=o(c).paths,f=h[r];f.bind(e,t,n,c),i(r)||s.each(p,function(r){n.scope.watch(r,function(){f.update(e,t,n,c)})})}},n.getTokensAndPathsFromDirective=o},{"./config":6,"./directives":9,"./parser":19,"./util":21}],3:[function(t,e,n){n.components={}},{}],4:[function(t,e,n){function r(t,e){if(1===t.nodeType){if(o(t,e),c(t).attr(u+"-repeat"))return;a.each(t.childNodes,function(t){r(t,e)})}else 3===t.nodeType&&i.bindText(t,e)}function o(t,e){var n=t.attributes;a.each(n,function(n){i.bindDir(n,t,e)})}var a=t("./util"),i=(t("./obserable"),t("./binder")),c=t("./dom"),s=t("./config"),u=s.directivePrefix;n.compile=r},{"./binder":2,"./config":6,"./dom":14,"./obserable":18,"./util":21}],5:[function(t,e,n){var r=t("./util"),o=t("./compiler"),a=(t("./object-path"),t("./parser"),t("./dom")),i=(t("./event-emitter"),t("./scope")),c=t("./common"),s=c.components,u={init:function(t,e,n){e=e||r.extend(!0,{},h),this.el=a.getDOMNodeFromTemplate(n.template),this.state=t.state;var c=e.parent.scope;this.scope=new i(e.currentPath,this.state,c),this.scope.extra=e.extra||{},this.scope.extra.$this=this,r.extend(this,t),o.compile(this.el,this)},update:function(t){this.scope.update(t)},updateArray:function(){return this.scope.updateArray.apply(this.scope,arguments)}},h={currentPath:"",parent:{scope:{$root:null,currentPath:""}}};c.component=e.exports=function(t,e){var e=arguments.length>=2?e:t,n=function(t,n){this.init(t,n,e)},o=n.prototype;return r.extend(o,u),r.isString(t)&&t.length>0&&(s[t]=n),r.of(e,function(t,e){r.isFunction(e)&&(o[t]=e)}),n}},{"./common":3,"./compiler":4,"./dom":14,"./event-emitter":15,"./object-path":17,"./parser":19,"./scope":20,"./util":21}],6:[function(t,e,n){var r=n;r.openTag="{",r.closeTag="}",r.directivePrefix="w",r.arrayEventPrefix="$$array$$"},{}],7:[function(t,e,n){var r=t("../dom"),o=t("../parser");e.exports={bind:function(t,e,n,r){this.update(t,e,n,r)},update:function(t,e,n,a){var i=r(t);for(var c in a){var s=o.parseTokensAndPaths(a[c]),u=o.exec({exp:a[c],tokens:s.tokens,paths:s.paths},n.scope);u?i.addClass(c):i.removeClass(c)}}}},{"../dom":14,"../parser":19}],8:[function(t,e,n){var r=t("../util"),o=t("../object-path"),a=t("../common").components;e.exports={bind:function(t,e,n,i){function c(){}var s=e.value.split(":"),u=r.trim(s[0]),h=s[1]?r.trim(s[1]):"$item";a[u]||r.error("Component `"+u+"` is not found.");var p=a[u],f=n.scope.getObjectByPath(h),l="$item"===h?"":h;c.prototype=n.constructor.prototype;var v=new c;r.extend(v,p.prototype),p.prototype=v;var m=new p({state:f},{parent:n,currentPath:o.join([n.scope.currentPath,l])});r.nextTick(function(){t.innerHTML="",t.appendChild(m.el)})}}},{"../common":3,"../object-path":17,"../util":21}],9:[function(t,e,n){t("../dom");n.show=t("./show"),n.model=t("./model"),n["class"]=t("./class"),n.component=t("./component"),n.repeat=t("./repeat"),n.on=t("./on")},{"../dom":14,"./class":7,"./component":8,"./model":10,"./on":11,"./repeat":12,"./show":13}],10:[function(t,e,n){var r=t("../dom"),o=t("../object-path"),a={};a.text={bind:function(t,e,n,a){function i(){var e=a.replace(/\(\)/g,""),r=o.makePathFromRawPath(e),i=o.makeObjectByPath(r,t.value),c=o.getFirstProp(r),s=n.scope.getRightScopeByToken(c);s.update(i)}this.update(t,e,n,a),r(t).on("input",i),r(t).on("keyup",i)},update:function(t,e,n,r){var a=r.replace(/\(\)/g,""),i=o.makePathFromRawPath(a),c=o.getFirstProp(i),s=n.scope.getRightScopeByToken(c),u=s.getObjectByPath(i);u!==t.value&&(t.value=u)}},a.checkbox={bind:function(t,e,n,o){var a=r(t);this.update(t,e,n,o),a.on("click",function(){var e=o.replace(/\(\)/g,"");if(t.checked)var r=!0;else var r=!1;var a={};a[e]=r,n.scope.update(a)})},update:function(t,e,n,o){var a=o.replace(/\(\)/g,""),i=r(t);n.scope.state[a]?i.attr("checked","checked"):i.removeAttr("checked")}},e.exports={bind:function(t,e,n,o){var i=r(t).attr("type")||"text";"textarea"===i&&(i="text"),a[i].bind(t,e,n,o)},update:function(t,e,n,o){var i=r(t).attr("type")||"text";"textarea"===i&&(i="text"),a[i].update(t,e,n,o)}}},{"../dom":14,"../object-path":17}],11:[function(t,e,n){function r(t,e,n){if(0===t.length)return[n];var r=[];return a.each(t,function(t){r.push("$event"===t?n:e.scope.getObjectByPath(a.trim(t)))}),r}var o=t("../dom"),a=t("../util");e.exports={bind:function(t,e,n,a){var i=/([\S\s]+)(\([\S\s]+\))/,c=o(t);for(var s in a){var u=a[s].match(i),h=[];if(u){var p=u[1];u[2]&&(h=u[2].replace(/[\(\)]/g,"").split(","))}else var p=a[s];!function(t,e,o){c.on(e,function(e){var a=r(t,n,e);n[o].apply(n,a)})}(h,s,p)}}}},{"../dom":14,"../util":21}],12:[function(t,e,n){function r(t,e,n,r,o){function c(){}var u=h(t),f=document.createComment("repeat "+r+" "+o),l=document.createComment("repeat "+r+" end "+o);u.before(f),u.before(l),u.remove(),u.removeAttr(e.name);var v=i(t),m=p.component({template:v});c.prototype=n.constructor.prototype,console.log(n,n.constructor.prototype),m.prototype=new c;var d=a(t,n,r,m,l),g=[f,l];return s(n,o,{Component:m,holders:g,components:d}),g}function o(t,e,n,r,o,i){var s=n.scope,p=n.scope.getScopeAndWatchPath(e.value).watchPath;s.watchArray(p,function(e,r){function p(){for(;m!==d;){var e=m.nextSibling;h(m).remove(),m=e}u.each(l.components,function(t){n.scope.removeSubScope(t.scope)});var r=a(t,n,i,l.Component,l.holders[1]);l.components=r}var l=c(n,o),v=l.holders[0],m=v.nextSibling,d=l.holders[1];switch(e){case"pop":if(d.previousSibling!==v){h(d.previousSibling).remove();var g=l.components.pop();s.removeSubScope(g.scope)}break;case"push":u.each(r,function(t,e){var r=l.components.length,o=f.join([n.scope.currentPath,i,r]),a=new l.Component({state:t},{currentPath:o,parent:n,extra:{$index:r,$item:t}});l.components.push(a),h(d).before(a.el)});break;default:p()}})}function a(t,e,n,r,o){var a=h.frag(),i=e.scope.getObjectByPath(n),c=[];return u.each(i,function(t,o){var i=new r({state:t},{currentPath:f.join([e.scope.currentPath,n,o]),parent:e,extra:{$index:o,$item:t}});c.push(i),a.appendChild(i.el)}),h(o).before(a),c}function i(t){var e=h.ele("div");return e.appendChild(t),e.innerHTML}function c(t,e){return t.scope.$root.repeatCache[e]}function s(t,e,n){var r=t.scope.$root;r.repeatCache||(r.repeatCache=[]),r.repeatCache[e]=n}var u=t("../util"),h=t("../dom"),p=t("../common"),f=(p.components,t("../object-path")),l=0;e.exports={bind:function(t,e,n,a){u.nextTick(function(){!function(i){var c=r(t,e,n,a,i);o(t,e,n,c,i,a)}(l++)})}}},{"../common":3,"../dom":14,"../object-path":17,"../util":21}],13:[function(t,e,n){var r=t("../dom");e.exports={bind:function(t,e,n){this.update(t,e,n)},update:function(t,e,n){var o=n.scope.state[e.value];r(t).css("display",o?"block":"none")}}},{"../dom":14}],14:[function(t,e,n){var r=t("./util"),o=function(t){return{el:t,attr:function(t,e){return 1===arguments.length?this.el.getAttribute(t):void this.el.setAttribute(t,e)},removeAttr:function(t){this.el.removeAttribute(t)},css:function(t,e){1===arguments.length?this.el.style[t]:this.el.style[t]=e},on:function(t,e){var n=this.el;return n.addEventListener?n.addEventListener(t,e,!1):n.attachEvent?n.attachEvent("on"+t,e):n[t]=e,this},addClass:function(t){var e=new RegExp("(^|\\s)"+t+"(\\s|$)"),n=r.trim(this.el.className);if(!e.test(n)){var o=0===this.el.className.length?"":" ";this.el.className+=o+t}return this},removeClass:function(t){var e=this.el.className,n=new RegExp("(^|\\s)"+t+"(\\s|$)");this.el.className=r.trim(e.replace(n,"$1"))},html:function(t){return 0===arguments.length?this.el.innerHTML:void(this.el.innerHTML=t)},remove:function(t){if(!this.el.parentNode&&t){var e=this;r.nextTick(function(){e.remove(t)})}else this.el.parentNode.removeChild(this.el);return this},before:function(t,e){if(!this.el.parentNode&&e){var n=this;r.nextTick(function(){n.before(t,e)})}else this.el.parentNode.insertBefore(t,this.el);return this}}};o.getDOMNodeFromTemplate=function(t){var e=document.createElement("div");return e.innerHTML=t,e.children[0]},o.frag=function(){return document.createDocumentFragment()},o.ele=function(t){return document.createElement(t)},e.exports=o},{"./util":21}],15:[function(t,e,n){function r(){this.events={}}var o=t("./util"),a=r.prototype;a.on=function(t,e){this.events[t]?this.events[t].push(e):this.events[t]=[e]},a.emit=function(t){var e=this.events[t];if(e){var n=[].slice.call(arguments,1);o.each(e,function(t){t.apply(t,n)})}},a.off=function(t,e){var n=this.events[t];if(n)for(var r=0,o=n.length;o>r;r++)n[r]===e&&(n.splice(r,1),0===n.length&&delete this.events[t])},e.exports=r},{"./util":21}],16:[function(t,e,n){function r(t){}r.component=t("./component"),r.render=function(t,e){t.innerHTML="",t.appendChild(e.el)},window.Wet=r},{"./component":5}],17:[function(t,e,n){var r=t("./util"),o=t("./config");n.getFirstProp=function(t){var e=/(^[\w_\$][\w\$_]+)([\.\[\]])?/;return t.match(e)[1]},n.makePathFromRawPath=function(t){var e=/(\[)|(\](\.)?)/g;return t.replace(e,".").replace(/\.$/,"")},n.makeStepsFromPath=function(t){var e=t.split("."),n=e[0],o=[n];return r.each(e,function(t,e){0!=e&&(n+="."+t,o.push(n))}),o},n.makePathsOfObj=function(t){function e(t,a,i){var c=n.join([i,t]);r.isObject(a)?r.of(a,function(t,n){e(t,n,c)}):o.push(c)}var o=[];return r.of(t,e),o},n.join=function(t){var e="";return r.each(t,function(t,n){r.isUndefined(t)||r.isString(t)&&0===t.length||(e=0===e.length?t:e+("."+t))}),e},n.getObjectByPath=function(t,e){var n=e.split("."),o=t;return r.each(n,function(t){o=o[t]}),o},n.makeObjectByPath=function(t,e){var o={},a=o;t=n.makePathFromRawPath(t);var i=t.split("."),c=i.length-1;return r.each(i,function(t,n){n!==c?a=a[t]={}:a[t]=e}),o},n.makeArrayEvent=function(t,e){return o.arrayEventPrefix+":"+t+":"+e}},{"./config":6,"./util":21}],18:[function(t,e,n){function r(t){function e(t){return 0===arguments.length?n.value:(n.oldValue=this.value,n.value=t,void n.notify())}var n=this;return this.value=t,this.watchers=[],e.$$=n,e}function o(t){}function a(t){return i.isArray(t)?new o(t):new r(t)}var i=t("./util.js");r.prototype.notify=function(){var t=this;i.each(this.watchers,function(e){e(t.value,t.oldValue,t)})},r.prototype.watch=function(t){this.watchers.push(t)},a.ObserableKey=r,a.ObserableArray=o,e.exports=a},{"./util.js":21}],19:[function(t,e,n){function r(){a=u.openTag.replace(f,"\\$1"),i=u.closeTag.replace(f,"\\$1"),c=new RegExp(a+"[\\S\\s]+?"+i,"g"),s=new RegExp(a+"|"+i,"g")}function o(t){var e=/["']/g;return t.replace(e,"")}var a,i,c,s,u=t("./config"),h=t("./util"),p=t("./object-path"),f=/(\*\.\?\+\$\^\[\]\(\)\{\}\|\\\/)/g;n.getRawExps=function(t){var e=t.match(c)||[];return e},n.getExpFromRawExp=function(t){return t.replace(s,"")};var l=/[_\w\$][_\$\w\d\.\[\]]+/g,v="Math,Date,this,true,false,null,undefined,Infinity,NaN,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,parseInt,parseFloat,in,JSON",m=new RegExp("^("+v.replace(/,/g,"\\b|")+"\\b)");n.parse=function(t){r();var e=n.getRawExps(t),o=[];return h.each(e,function(t){var e=n.getExpFromRawExp(t),r=n.parseTokensAndPaths(e),a={rawExp:t,exp:e,tokens:r.tokens,paths:r.paths};o.push(a)}),o},n.parseTokensAndPaths=function(t){var e=/('[\s\S]*?')|("[\s\S]*?")/g;t=t.replace(e,"");var n=t.match(l)||[],r={},o={},a=[],i=[];h.each(n,function(t){c=p.getFirstProp(t),m.test(c)||(r[c]=1,o[t]=1)});for(var c in r)a.push(c);for(var s in o)i.push(p.makePathFromRawPath(s));return{tokens:a,paths:i}},n.exec=function(t,e){var n=[],r=t.tokens;h.each(r,function(t){n.push(e.get(t))});var o="return "+t.exp+";";return new Function(r,o).apply(e,n)},n.parseDirective=function(t){function e(){a[h.trim(o(r))]=h.trim(c),r="",c=""}var n=/^[_$\w][_$\w\d\s\(\)\.\[\]]*$/,t=h.trim(t);if(0===t.length||n.test(t))return p.makePathFromRawPath(t);var r,a={},i=0,c="",s=t.split("");return h.each(s,function(t){switch(i){case 0:c+=t,i=1;break;case 1:":"===t?(r=c,c="",i=2):c+=t;break;case 2:","===t?(e(),i=1):"("===t?(c+=t,i=3):c+=t;break;case 3:c+=t,")"===t&&(i=4);break;case 4:","===t&&(e(),i=1)}}),e(),a},r()},{"./config":6,"./object-path":17,"./util":21}],20:[function(t,e,n){function r(t,e,n){this.currentPath=t,this.state=e,this.watchPaths={},this.subScopes=[],this.parentScope=n,n&&n.$root&&t?(this.$root=n.$root,n.subScopes.push(this)):(this.$root=this,this.emitter=new i)}function o(t){return a.startsWith(t,s.arrayEventPrefix)}var a=t("./util"),i=t("./event-emitter"),c=t("./object-path"),s=t("./config"),u=t("./array-factory"),h=r.prototype;h.update=function(t){var e=this,n=c.makePathsOfObj(t);a.update(this.state,t),a.each(n,function(t){var n=e.getObjectByPath(t),r=c.join([e.currentPath,t]);a.isArray(n)&&(r=s.arrayEventPrefix+":replace:"+r),e.$root.broadcast(r)})},h.updateArray=function(t){var e=this.getObjectByPath(t);return a.isArray(e)||a.error(t+" is not an array"),new u(e,t,this)},h.watchArray=function(t,e){var n=this.getObjectByPath(t);a.isArray(n)||a.error(t+" is not an array");var r=["replace","pop","push","shift","unshift","splice","sort","reverse"],o=this;a.each(r,function(n){var r=c.makeArrayEvent(n,t),a=function(){[].unshift.call(arguments,n),e.apply(e,arguments)};o.$root.emitter.on(r,a),o.addLocalWatchPath(r,a)})},h.broadcast=function(t,e){if(!this.emitter)return a.error("I am not a root!");if(o(t)){this.$root.emitter.emit(t,e);var n=t.split(":")[2];for(var r in this.emitter.events)a.startsWith(r,n)&&r.length>n.length&&this.emitter.emit(r,e);t=n}var i=c.makeStepsFromPath(t),s=this;a.each(i,function(t){s.$root.emitter.emit(t,e)})},h.watch=function(t,e){var n=this.getScopeAndWatchPath(t),r=n.watchPath;this.addLocalWatchPath(t,e),this.$root.emitter.on(r,e)},h.addLocalWatchPath=function(t,e){var n=this.watchPaths[t];n?n.push(e):this.watchPaths[t]=[e]},h.getScopeAndWatchPath=function(t){t=c.makePathFromRawPath(t);var e=c.getFirstProp(t),n=this.getRightScopeByToken(e),r=c.join([n.currentPath,t]);return{scope:n,watchPath:r}},h.getRightScopeByToken=function(t){for(var e=this,n=!1;""!=e.currentPath&&a.isUndefined(e.state[t])&&a.isUndefined(e.extra[t]);)e=e.parentScope,n=!0;return n?e:this},h.removeSubScope=function(t){for(var e=this.subScopes,n=0,r=e.length;r>n;n++)if(e[n]===t)return t.unwatch(),e.splice(n,1)},h.unwatch=function(){var t=this.watchPaths,e=this.$root,n=this;for(var r in t)a.each(t[r],function(t){var o=c.join([n.currentPath,r]);e.emitter.off(o,t)});a.each(this.subScopes,function(t){t.unwatch()})},h.get=function(t){var e=this.getRightScopeByToken(t),n=e.state[t]||e.extra[t];return a.isUndefined(n)?"":n},h.getObjectByPath=function(t){t=c.makePathFromRawPath(t);var e=c.getFirstProp(t),n=this.getRightScopeByToken(e),r=c.getObjectByPath(n.state,t);return a.isUndefined(r)?c.getObjectByPath(n.extra,t):r},e.exports=r},{"./array-factory":1,"./config":6,"./event-emitter":15,"./object-path":17,"./util":21}],21:[function(t,e,n){function r(t,e){return!a.isUndefined(t)&&(a.isObject(t)||a.isArray(t))&&!a.isUndefined(e)&&a.isObject(e)}var o=t("./obserable"),a=n;a.isObserable=function(t){var t=t.$$;return t instanceof o.ObserableKey||t instanceof o.ObserableArray},a.map=function(t,e){for(var n=[],r=0,o=t.length;o>r;r++)n.push(e(t[r]));return n},a.isArray=function(t){return"[object Array]"===a.toString(t)},a.isString=function(t){return"[object String]"===a.toString(t)},a.isObject=function(t){return"[object Object]"===a.toString(t)},a.toString=function(t){return Object.prototype.toString.call(t)},a.each=function(t,e){for(var n=0,r=t.length;r>n;n++)e(t[n],n)},a.isUndefined=function(t){return void 0===t},a.trim=function(t){return t.replace(/(^\s+)|\s+$/g,"")},a.extend=function(t){for(var e=arguments,n=t===!0?2:1,o=arguments[n-1],i=e.length;i>n;n++){var c=e[n];for(var s in c)c.hasOwnProperty(s)&&(r(o[s],c[s])?a.extend(o[s],c[s]):o[s]=c[s])}return o},a.update=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(r(t[n],e[n])?a.update(t[n],e[n]):t[n]=e[n]);return t},a.of=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])},a.startsWith=function(t,e,n){return n=n||0,t.indexOf(e,n)===n},a.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){a["is"+t]=function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}),a.error=function(t){throw new Error(t)},a.nextTick=function(t,e){e=e||0,setTimeout(t,e)}},{"./obserable":18}]},{},[16]);